"use strict";(self.webpackChunkmir_guia=self.webpackChunkmir_guia||[]).push([[8681],{3905:(e,n,a)=>{a.d(n,{Zo:()=>c,kt:()=>k});var s=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function t(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,s)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function i(e,n){if(null==e)return{};var a,s,r=function(e,n){if(null==e)return{};var a,s,r={},t=Object.keys(e);for(s=0;s<t.length;s++)a=t[s],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(s=0;s<t.length;s++)a=t[s],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=s.createContext({}),p=function(e){var n=s.useContext(l),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},c=function(e){var n=p(e.components);return s.createElement(l.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return s.createElement(s.Fragment,{},n)}},m=s.forwardRef((function(e,n){var a=e.components,r=e.mdxType,t=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(a),m=r,k=u["".concat(l,".").concat(m)]||u[m]||d[m]||t;return a?s.createElement(k,o(o({ref:n},c),{},{components:a})):s.createElement(k,o({ref:n},c))}));function k(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var t=a.length,o=new Array(t);o[0]=m;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[u]="string"==typeof e?e:r,o[1]=i;for(var p=2;p<t;p++)o[p]=a[p];return s.createElement.apply(null,o)}return s.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8902:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>t,metadata:()=>i,toc:()=>p});var s=a(7462),r=(a(7294),a(3905));const t={},o="Cookies y sesi\xf3n",i={unversionedId:"nodejs/express/cookies-y-sesion",id:"nodejs/express/cookies-y-sesion",title:"Cookies y sesi\xf3n",description:"HTTP es un protocolo sin estado. Cada petici\xf3n es completamente independiente de otra y no hay forma de compartir informaci\xf3n entre las peticiones.",source:"@site/docs/nodejs/express/cookies-y-sesion.md",sourceDirName:"nodejs/express",slug:"/nodejs/express/cookies-y-sesion",permalink:"/docs/nodejs/express/cookies-y-sesion",draft:!1,editUrl:"https://github.com/makeitrealcamp/new-guides/tree/main/docs/nodejs/express/cookies-y-sesion.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Formularios",permalink:"/docs/nodejs/express/formularios"},next:{title:"Creando una Web API",permalink:"/docs/nodejs/express/avanzado/web-api"}},l={},p=[{value:"Cookies",id:"cookies",level:2},{value:"Sesiones",id:"sesiones",level:2},{value:"Almacenando la sesi\xf3n en el navegador",id:"almacenando-la-sesi\xf3n-en-el-navegador",level:3},{value:"Almacenando la sesi\xf3n en el servidor",id:"almacenando-la-sesi\xf3n-en-el-servidor",level:2}],c={toc:p},u="wrapper";function d(e){let{components:n,...a}=e;return(0,r.kt)(u,(0,s.Z)({},c,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"cookies-y-sesi\xf3n"},"Cookies y sesi\xf3n"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"HTTP")," es un protocolo sin estado. Cada petici\xf3n es completamente independiente de otra y no hay forma de compartir informaci\xf3n entre las peticiones."),(0,r.kt)("p",null,"Las ",(0,r.kt)("strong",{parentName:"p"},"cookies")," nos permiten almacenar informaci\xf3n en el navegador del usuario. Piensa en las ",(0,r.kt)("strong",{parentName:"p"},"cookies")," como un objeto de JavaScript."),(0,r.kt)("p",null,"Una ",(0,r.kt)("strong",{parentName:"p"},"sesi\xf3n")," Web es el tiempo que dura un visitante en nuestra aplicaci\xf3n antes de cerrar la pesta\xf1a, navegar a otra p\xe1gina, o estar inactivo por cierto tiempo."),(0,r.kt)("h2",{id:"cookies"},"Cookies"),(0,r.kt)("p",null,"Para escribir una ",(0,r.kt)("strong",{parentName:"p"},"cookie")," utiliza el m\xe9todo ",(0,r.kt)("inlineCode",{parentName:"p"},"res.cookie"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"res.cookie('name', 'pedro', { domain: '.example.com', path: '/admin', secure: true });\nres.cookie('rememberme', '1', { expires: new Date(Date.now() + 900000), httpOnly: true });\n")),(0,r.kt)("p",null,"Para leer las ",(0,r.kt)("strong",{parentName:"p"},"cookies")," necesitas configurar un ",(0,r.kt)("strong",{parentName:"p"},"middleware")," llamado ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/expressjs/cookie-parser"},"cookie-parser"),"."),(0,r.kt)("p",null,"El primer paso es instalarlo con npm o Yarn:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"$ npm install --save cookie-parser\n")),(0,r.kt)("p",null,"El siguiente paso es configurar el ",(0,r.kt)("strong",{parentName:"p"},"middleware"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"let express = require('express');\nlet cookieParser = require('cookie-parser');\n\nlet app = express();\napp.use(cookieParser());\n")),(0,r.kt)("p",null,"Con este ",(0,r.kt)("strong",{parentName:"p"},"middleware")," puedes utilizar el m\xe9todo ",(0,r.kt)("inlineCode",{parentName:"p"},"req.cookies")," y ",(0,r.kt)("inlineCode",{parentName:"p"},"req.signedCookies")," ","(","para leer cookies cifradas",")","."),(0,r.kt)("h2",{id:"sesiones"},"Sesiones"),(0,r.kt)("p",null,"Una ",(0,r.kt)("strong",{parentName:"p"},"sesi\xf3n")," inicia cuando el visitante ingresa por primera vez a un sitio o aplicaci\xf3n Web, o despu\xe9s de que ese mismo visitante ha finalizado una sesi\xf3n previa."),(0,r.kt)("p",null,"Generalmente se define que la ",(0,r.kt)("strong",{parentName:"p"},"sesi\xf3n")," termina despu\xe9s de 30 minutos de inactividad del visitante, pero dependiendo del sistema que utilicemos para almacenar la informaci\xf3n de la sesi\xf3n, es posible dejar abierta la sesi\xf3n d\xedas o meses."),(0,r.kt)("p",null,"El objetivo de definir este concepto de ",(0,r.kt)("strong",{parentName:"p"},"sesi\xf3n")," es poder almacenar informaci\xf3n que sobrevive las peticiones HTTP de un visitante."),(0,r.kt)("p",null,"La ",(0,r.kt)("strong",{parentName:"p"},"sesi\xf3n")," involucra una ",(0,r.kt)("strong",{parentName:"p"},"cookie")," con una fecha de expiraci\xf3n, generalmente de 30 minutos."),(0,r.kt)("p",null,"Cada vez que el visitante hace una petici\xf3n HTTP la ",(0,r.kt)("strong",{parentName:"p"},"cookie")," se actualiza para extender la ",(0,r.kt)("strong",{parentName:"p"},"sesi\xf3n"),"."),(0,r.kt)("p",null,"Cuando han pasado m\xe1s de 30 minutos de inactividad la ",(0,r.kt)("strong",{parentName:"p"},"cookie")," expira y la pr\xf3xima vez que el visitante ingrese se va a crear una nueva ",(0,r.kt)("strong",{parentName:"p"},"sesi\xf3n"),"."),(0,r.kt)("p",null,"La informaci\xf3n de la ",(0,r.kt)("strong",{parentName:"p"},"sesi\xf3n")," es un objeto de JavaScript que se puede almacenar en el cliente (dentro de una cookie) o en el servidor (en una base de datos o la memoria)."),(0,r.kt)("h3",{id:"almacenando-la-sesi\xf3n-en-el-navegador"},"Almacenando la sesi\xf3n en el navegador"),(0,r.kt)("p",null,"Para almacenar la sesi\xf3n de cada usuario en una cookie debes utilizar el ",(0,r.kt)("strong",{parentName:"p"},"middleware")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/expressjs/cookie-session"},"cookie-session"),"."),(0,r.kt)("p",null,"El primer paso es instalarlo con npm o Yarn:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"$ npm install cookie-session\n")),(0,r.kt)("p",null,"El segundo paso es configurarlo de la siguiente forma:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"let express = require('express');\nlet cookieSession = require('cookie-session')\n\napp.use(cookieSession({\n  secret: /* una cadena de texto aleatoria */,\n\n  // Cookie Options\n  maxAge: 24 * 60 * 60 * 1000 // 24 hours\n}))\n\n...\n")),(0,r.kt)("p",null,"Ahora puedes acceder a la sesi\xf3n del usuario que hizo la petici\xf3n con ",(0,r.kt)("inlineCode",{parentName:"p"},"req.session"),". Por ejemplo:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"app.get('/', (req, res, next) => {\n  req.session.views = (req.session.views || 0) + 1\n\n  // Write response\n  res.send(req.session.views + ' views');\n});\n")),(0,r.kt)("h2",{id:"almacenando-la-sesi\xf3n-en-el-servidor"},"Almacenando la sesi\xf3n en el servidor"),(0,r.kt)("p",null,"Aunque almacenar las sesiones en una ",(0,r.kt)("strong",{parentName:"p"},"cookies")," es una buena soluci\xf3n, una limitaci\xf3n es que una ",(0,r.kt)("strong",{parentName:"p"},"cookie")," no puede ocupar m\xe1s de 4KB de memoria."),(0,r.kt)("p",null,"Otra opci\xf3n es almacenar la informaci\xf3n de las sesiones en el servidor y guardar en la ",(0,r.kt)("strong",{parentName:"p"},"cookie")," un identificador para localizar la informaci\xf3n de esa sesi\xf3n en el servidor."),(0,r.kt)("p",null,"El ",(0,r.kt)("strong",{parentName:"p"},"middleware")," que se utiliza para almacenar la sesi\xf3n en el servidor es ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/expressjs/session"},"express-session"),", que permite almacenar las sesiones en diferentes bases de datos como MongoDB, Redis, etc."),(0,r.kt)("p",null,"Vamos a omitir la explicaci\xf3n de este ",(0,r.kt)("strong",{parentName:"p"},"middleware")," en este cap\xedtulo porque en la mayor\xeda de los casos ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/expressjs/cookie-session"},"cookie-session")," es suficiente, pero puedes consultar ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/expressjs/session"},"la documentaci\xf3n")," si deseas utilizar esta opci\xf3n."))}d.isMDXComponent=!0}}]);